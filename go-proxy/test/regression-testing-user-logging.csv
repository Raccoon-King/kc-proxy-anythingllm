Test ID,Category,Test Case,Preconditions,Steps,Expected Log Output,Verify IP,Verify User Agent,Verify User Identity,Verify Extra Fields,Pass/Fail,Notes
UAL-001,Login Success,User logs in successfully via Keycloak,User exists in Keycloak and AnythingLLM,"1. Navigate to /login 2. Authenticate with valid Keycloak credentials 3. Complete OAuth callback","[USER] LOGIN_SUCCESS user=""john@example.com"" ip=<client_ip> ua=""<browser_ua>"" userID=<id>",Yes,Yes,Yes,userID present,,
UAL-002,Login Success,User logs in with preferred_username,User has preferred_username set in Keycloak,"1. Navigate to /login 2. Authenticate with Keycloak",Log shows user as preferred_username,Yes,Yes,Yes,userID present,,
UAL-003,Login Success,User logs in without email (subject fallback),User has no email or preferred_username in Keycloak token (subject present),"1. Navigate to /login 2. Authenticate",Log shows user as subject@oidc.local,Yes,Yes,Yes,userID present,,
UAL-004,Login Failure,OAuth state mismatch,Valid session exists,"1. Start OAuth flow 2. Tamper with state parameter in callback","[USER] AUTH_REJECTED user=""<anonymous>"" ip=<client_ip> ua=""<browser_ua>"" reason=state_mismatch",Yes,Yes,No (anonymous),reason=state_mismatch,,
UAL-005,Login Failure,Missing PKCE verifier,OAuth flow started,"1. Start OAuth flow 2. Clear session 3. Complete callback","[USER] AUTH_REJECTED user=""<anonymous>"" ip=<client_ip> ua=""<browser_ua>"" reason=missing_pkce_verifier",Yes,Yes,No,reason=missing_pkce_verifier,,
UAL-006,Login Failure,Code exchange failure,Valid OAuth state,"1. Start OAuth flow 2. Use invalid/expired code in callback","[USER] AUTH_REJECTED user=""<anonymous>"" ip=<client_ip> ua=""<browser_ua>"" reason=code_exchange_failed",Yes,Yes,No,reason=code_exchange_failed,,
UAL-007,Login Failure,Invalid ID token,Code exchange succeeds,"1. Complete OAuth flow 2. Keycloak returns invalid token","[USER] AUTH_REJECTED user=""<anonymous>"" ip=<client_ip> ua=""<browser_ua>"" reason=invalid_token",Yes,Yes,No,reason=invalid_token,,
UAL-008,Login Failure,No ID token in response,Code exchange succeeds,"1. Complete OAuth flow 2. No id_token in response","[USER] AUTH_REJECTED user=""<anonymous>"" ip=<client_ip> ua=""<browser_ua>"" reason=no_id_token",Yes,Yes,No,reason=no_id_token,,
UAL-009,Access Denied,User not in AnythingLLM (auto-create disabled),"User exists in Keycloak but not AnythingLLM; ANYLLM_AUTO_CREATE=false","1. Login with valid Keycloak user 2. User lookup fails","[USER] ACCESS_DENIED user=""newuser@example.com"" ip=<client_ip> ua=""<browser_ua>"" reason=no_account",Yes,Yes,Yes,reason=no_account,,
UAL-010,Access Denied,EnsureUser API failure,AnythingLLM API unreachable,"1. Login with valid Keycloak user 2. EnsureUser call fails","[USER] ACCESS_DENIED user=""user@example.com"" ip=<client_ip> ua=""<browser_ua>"" reason=user_sync_failed",Yes,Yes,Yes,reason=user_sync_failed,,
UAL-011,Access Denied,SSO token issuance failure,User exists but token API fails,"1. Login successfully 2. IssueAuthToken fails","[USER] ACCESS_DENIED user=""user@example.com"" ip=<client_ip> ua=""<browser_ua>"" reason=token_issuance_failed userID=<id>",Yes,Yes,Yes,reason + userID,,
UAL-012,Logout,User initiates logout via /logout,User is logged in,"1. Click logout 2. Session cleared","[USER] LOGOUT user=""john@example.com"" ip=<client_ip> ua=""<browser_ua>""",Yes,Yes,Yes,,,
UAL-013,Logout,Logout via catch-all route (path contains logout),User is logged in,"1. Navigate to /any/path/logout","[USER] LOGOUT user=""john@example.com"" ip=<client_ip> ua=""<browser_ua>"" path=/any/path/logout",Yes,Yes,Yes,path field present,,
UAL-014,Logout,Logout with no valid session,No session or expired session,"1. Navigate to /logout","[USER] LOGOUT user=""<anonymous>"" ip=<client_ip> ua=""<browser_ua>""",Yes,Yes,No (anonymous),,,
UAL-015,Agreement,User accepts agreement,User logged in but agreement not accepted,"1. View agreement page 2. Click accept button","[USER] AGREEMENT_ACCEPTED user=""john@example.com"" ip=<client_ip> ua=""<browser_ua>""",Yes,Yes,Yes,,,
UAL-016,Agreement,Agreement accept without valid session,No valid session (or expired session),"1. POST to /agreement/accept","Redirect to login; if session expired with email, log [USER] SESSION_TIMEOUT user=""<email>"" ip=<client_ip> ua=""<browser_ua>"" reason=session_expired",N/A,N/A,N/A,,,
UAL-017,Session,Session expired - redirect to login,Session expiry passed (email present),"1. Wait for session to expire 2. Access protected route","[USER] SESSION_TIMEOUT user=""<email>"" ip=<client_ip> ua=""<browser_ua>"" reason=session_expired then redirect to /login",Yes,Yes,Yes,reason=session_expired,,
UAL-018,Session,SSO token re-issued on /sso/ without token,Valid session but missing SSO token,"1. Navigate to /sso/simple without token param","[USER] TOKEN_REISSUED user=""john@example.com"" ip=<client_ip> ua=""<browser_ua>"" userID=<id>",Yes,Yes,Yes,userID present,,
UAL-019,Session,SSO re-issue failure (ensure user),Valid session but EnsureUser fails,"1. Navigate to /sso/simple without token 2. Re-issue fails",No [USER] log (falls back to Keycloak logout),N/A,N/A,N/A,,,
UAL-020,Rate Limiting,User rate limited,Rate limiting enabled; threshold exceeded,"1. Send requests exceeding RATE_LIMIT_PER_MIN","[USER] RATE_LIMITED user=""<by-ip>"" ip=<client_ip> ua=""<browser_ua>""",Yes,Yes,No (IP-based),,,
UAL-021,Security Headers,X-Forwarded-For header parsing,Request has X-Forwarded-For header,"1. Send request with X-Forwarded-For: 10.0.0.1","Log shows ip=10.0.0.1 (first IP in chain)",Yes,Yes,N/A,,,
UAL-022,Security Headers,X-Real-IP header parsing,Request has X-Real-IP header (no X-Forwarded-For),"1. Send request with X-Real-IP: 10.0.0.2","Log shows ip=10.0.0.2",Yes,Yes,N/A,,,
UAL-023,Security Headers,RemoteAddr fallback,No proxy headers present,"1. Send direct request","Log shows ip from r.RemoteAddr",Yes,Yes,N/A,,,
UAL-024,User Agent,Long user agent truncation,User agent > 100 chars,"1. Send request with very long UA string","UA truncated to 100 chars + ...",Yes,Yes (truncated),N/A,,,
UAL-025,User Agent,Empty user agent,No User-Agent header,"1. Send request without User-Agent","Log shows ua=""""",Yes,Yes (empty),N/A,,,
UAL-026,Multiple IPs,X-Forwarded-For with multiple IPs,Request proxied through multiple hops,"1. Send with X-Forwarded-For: 1.1.1.1, 2.2.2.2, 3.3.3.3","Log shows ip=1.1.1.1 (first/client IP)",Yes,Yes,N/A,,,
UAL-027,Edge Case,User with special characters in email,"Email contains +, ., etc","1. Login with user+test@example.com","Email properly quoted in log",Yes,Yes,Yes,Special chars preserved,,
UAL-028,Edge Case,Unicode in login ID,Keycloak preferred_username contains unicode,"1. Login with unicode preferred_username","Login ID properly encoded in log",Yes,Yes,Yes,Unicode preserved,,
UAL-029,Config,SECURITY_LOGGING=false,Logging disabled,"1. Set SECURITY_LOGGING=false 2. Perform login","No [USER] logs emitted",N/A,N/A,N/A,,,
UAL-030,Concurrent,Multiple simultaneous logins,Multiple users logging in,"1. Simulate 10 concurrent logins","Each login logged with correct user/IP",Yes,Yes,Yes,No cross-contamination,,
UAL-031,API Passthrough,API request /api/* path,User accessing API directly,"1. Send request to /api/v1/admin","API requests passed through - no [USER] log",N/A,N/A,N/A,,,API auth handled by AnythingLLM
UAL-032,Static Assets,Request for static asset,User requests .js/.css/.ico file,"1. Request /favicon.ico","No [USER] log (static assets skipped)",N/A,N/A,N/A,,,Performance optimization
UAL-033,Health Check,Health/readiness endpoints,System health check,"1. Request /healthz or /readyz","No [USER] log (system endpoints)",N/A,N/A,N/A,,,
UAL-034,AnythingLLM Auth Failure,Upstream returns 401/403,AnythingLLM rejects proxied request,"1. Login 2. AnythingLLM returns 401","Proxy forces re-login (no direct [USER] log)",N/A,N/A,N/A,,,Verify proxy redirects to /login
UAL-035,Session Limit,New login revokes old session (STIG V-222387),"SESSION_MAX_PER_USER=1 (default); user logged in on Browser A","1. User logs in on Browser A 2. Same user logs in on Browser B","[USER] SESSION_REVOKED user=""john@example.com"" ... reason=session_limit_exceeded old_session=<id>",Yes,Yes,Yes,reason + old_session,,
UAL-036,Session Limit,Old session rejected after new login,"User has active session; then logs in from another device","1. Login on Browser A 2. Login on Browser B 3. Try to access app from Browser A","[USER] SESSION_INVALID user=""john@example.com"" ... reason=superseded_by_new_login",Yes,Yes,Yes,reason=superseded_by_new_login,,Browser A redirected to /login
UAL-037,Session Limit,Session limit disabled,"SESSION_MAX_PER_USER=0","1. Login on Browser A 2. Login on Browser B 3. Access app from both","No SESSION_REVOKED or SESSION_INVALID logs; both sessions valid",N/A,N/A,N/A,,,Both browsers remain logged in
UAL-038,Session Limit,Logout removes session from tracker,User logged in with session limit enabled,"1. Login 2. Logout 3. Login again","No SESSION_REVOKED on second login (first was properly removed)",Yes,Yes,Yes,,,Clean logout properly clears tracker
UAL-039,Session Limit,Session ID stored in cookie,New login,"1. Login 2. Check session cookie contains session_id","Session cookie has session_id field",N/A,N/A,N/A,,,Internal verification
UAL-040,Session Timeout,Session timeout logged (STIG V-222445),User has expired session,"1. Login 2. Wait for session to expire 3. Access protected route","[USER] SESSION_TIMEOUT user=""john@example.com"" ... reason=session_expired",Yes,Yes,Yes,reason=session_expired,,
UAL-041,Session Timeout,No timeout log for never-authenticated session,No session cookie,"1. Access protected route without ever logging in","No SESSION_TIMEOUT log (redirect to login)",N/A,N/A,N/A,,,Only log timeout for previously valid sessions
UAL-042,Session Timeout,Timeout on agreement page,Expired session tries to access agreement,"1. Login 2. Wait for expiry 3. Access /agreement","[USER] SESSION_TIMEOUT ... then redirect to login",Yes,Yes,Yes,,,
UAL-043,Session Timeout,Timeout on agreement accept,Expired session tries to accept agreement,"1. Login 2. Wait for expiry 3. POST /agreement/accept","[USER] SESSION_TIMEOUT ... then redirect to login",Yes,Yes,Yes,,,
UAL-044,Last Login Display,Login time shown on agreement page (STIG V-222437),User just logged in,"1. Login 2. View agreement page","Agreement page shows 'Current login: <timestamp> from <IP>'",N/A,N/A,N/A,,,Verify timestamp and IP displayed
UAL-045,Last Login Display,Login IP stored in session,New login from specific IP,"1. Login from IP 10.0.0.1 2. Check agreement page","Shows 'from 10.0.0.1'",Yes,N/A,N/A,,,
UAL-046,Last Login Display,Login time format,User views agreement page,"1. Login 2. View agreement page","Time formatted as YYYY-MM-DD HH:MM:SS TZ",N/A,N/A,N/A,,,Human-readable format
